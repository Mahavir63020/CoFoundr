<!DOCTYPE html>
<html>
<head>
  <title>Solvearn MVP</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div id="auth-section">
  <h2>Sign Up</h2>
  <input type="email" id="signup-email" placeholder="Email"><br>
  <input type="password" id="signup-password" placeholder="Password"><br>
  <button onclick="signup()">Sign Up</button>

  <h2>Login</h2>
  <input type="email" id="login-email" placeholder="Email"><br>
  <input type="password" id="login-password" placeholder="Password"><br>
  <button onclick="login()">Log In</button>

  <hr>
  <button onclick="googleLogin()">Sign In with Google</button>
</div>

<div id="main-app" style="display:none;">
  <button onclick="logout()">Log Out</button>
  <!-- Your main app content goes here -->
    
    <h2>Create a Project</h2>
<input id="project-title" placeholder="Project Title"><br>
<textarea id="project-desc" placeholder="Project Description"></textarea><br>
<input id="project-roles" placeholder="Roles (comma-separated: e.g. Designer,Frontend)"><br>
<button onclick="createProject()">Create Project</button>

<hr>

<h2>All Projects</h2>
<div id="project-list"></div>

<hr>
  
<h2>Your Notifications</h2>
<div id="notif-list"></div>


</div>


  <nav>
    <button onclick="showView('home')">Home</button>
    <button onclick="showView('create')">Create Project</button>
    <button onclick="showView('myProjects')">My Projects</button>
    <button onclick="showView('chat')">Chat</button>
  </nav>

  <div id="home" class="view">
    <h1>Featured Projects</h1>
    <div id="project-list"></div>
  </div>

  <div id="create" class="view" style="display: none;">
    <h1>Create a Project</h1>
    <form id="create-form">
      <input type="text" id="project-name" placeholder="Project Name" required><br>
      <textarea id="project-desc" placeholder="Description" required></textarea><br>
      <input type="text" id="project-roles" placeholder="Roles (comma separated)" required><br>
      <button type="submit">Create</button>
    </form>
  </div>

  <div id="myProjects" class="view" style="display: none;">
    <h1>My Projects</h1>
    <div id="my-projects-list"></div>
  </div>

  <div id="chat" class="view" style="display: none;">
    <h1>Chat</h1>
    <div id="chat-box">No messages yet</div>
    <input id="chat-input" placeholder="Type a message">
    <button onclick="sendMessage()">Send</button>
  </div>

  <script src="js/main.js"></script>
  <script src="js/project.js"></script>
  <script src="js/apply.js"></script>
  <script src="js/chat.js"></script>
  <script src="js/auth.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
  import {
    getFirestore, collection, addDoc, onSnapshot,
    query, updateDoc, doc
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import {
    getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC_wK8NlJw-yUvsqKkBFxBP1GdzqEbzWP8",
    authDomain: "solvearn-mvp-a00f1.firebaseapp.com",
    projectId: "solvearn-mvp-a00f1",
    storageBucket: "solvearn-mvp-a00f1.appspot.com",
    messagingSenderId: "71657733409",
    appId: "1:71657733409:web:1db68c51393ecd7dfc5260",
    measurementId: "G-NJGT0SJ2TP"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore();
  const auth = getAuth();
  const provider = new GoogleAuthProvider();

  // ðŸ”’ Google Sign-in
  document.getElementById("loginBtn").addEventListener("click", async () => {
    try {
      await signInWithPopup(auth, provider);
      alert("Signed in!");
    } catch (error) {
      console.error(error.message);
    }
  });

  const notifListDiv = document.getElementById("notif-list");

  // ðŸ”” Real-time Notification Listener
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const notifQuery = query(collection(db, "notifications"));
      onSnapshot(notifQuery, (snapshot) => {
        notifListDiv.innerHTML = "";
        snapshot.forEach(docSnap => {
          const notif = docSnap.data();
          const id = docSnap.id;

          if (notif.to === user.uid && notif.type === "application") {
            if (notif.status === "pending") {
              const notifDiv = document.createElement("div");
              notifDiv.innerHTML = `
                <p>${notif.message}</p>
                <button onclick="respondToApplication('${id}', '${notif.from}', 'accepted')">Accept</button>
                <button onclick="respondToApplication('${id}', '${notif.from}', 'rejected')">Reject</button>
                <hr>
              `;
              notifListDiv.appendChild(notifDiv);
            } else {
              const notifDiv = document.createElement("div");
              notifDiv.innerHTML = `
                <p><strong>Response sent to ${notif.fromEmail}</strong>: ${notif.status}</p>
                <small>${new Date(notif.timestamp.seconds * 1000).toLocaleString()}</small>
                <hr>
              `;
              notifListDiv.appendChild(notifDiv);
            }
          }

          if (notif.from === user.uid && notif.status !== "pending") {
            const notifDiv = document.createElement("div");
            notifDiv.innerHTML = `
              <p><strong>Application to "${notif.projectTitle}" was ${notif.status}</strong></p>
              <small>${new Date(notif.timestamp.seconds * 1000).toLocaleString()}</small>
              <hr>
            `;
            notifListDiv.appendChild(notifDiv);
          }
        });
      });
    }
  });

  // ðŸŸ¢ Handle Accept / Reject
  window.respondToApplication = async function (notifId, applicantId, result) {
    const notifRef = doc(db, "notifications", notifId);
    await updateDoc(notifRef, {
      status: result
    });
    alert(`User has been ${result}`);
  };

  // ðŸ“¤ Call this when applying to project
  window.applyToProject = async function (projectId, projectTitle, creatorUid) {
    const user = auth.currentUser;
    if (!user) return alert("Please sign in first");

    await addDoc(collection(db, "notifications"), {
      to: creatorUid,
      from: user.uid,
      fromEmail: user.email,
      message: `${user.email} applied to your project "${projectTitle}"`,
      projectId,
      projectTitle,
      status: "pending",
      timestamp: new Date(),
      type: "application"
    });

    alert("Applied successfully");
  };
</script>



</body>
</html>
