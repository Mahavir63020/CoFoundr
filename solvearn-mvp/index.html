<!DOCTYPE html>
<html>
<head>
  <title>Solvearn MVP</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    :root {
      --deep-teal: #087E8B;
      --soft-white: #F5F5F5;
      --charcoal: #363636;
      --vibrant-coral: #FF5A5F;
      --pale-gold: #FFD166;
      --soft-sage: #97C1A9;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--soft-white);
      color: var(--charcoal);
    }

    #auth-section, #main-app {
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    h1, h2, h3 {
      color: var(--deep-teal);
    }

    input, textarea {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border: 1px solid var(--deep-teal);
      border-radius: 4px;
      background-color: #fff;
    }

    button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border: none;
      border-radius: 4px;
      background-color: var(--deep-teal);
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: var(--vibrant-coral);
    }

    button[type="submit"], 
    button[onclick*="create"] {
      background-color: var(--vibrant-coral);
    }

    button[onclick*="google"] {
      background-color: var(--pale-gold);
      color: var(--charcoal);
    }

    .success {
      color: var(--soft-sage);
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    nav button {
      flex: 1;
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    #project-list > div, 
    #notif-list > div {
      border: 1px solid var(--deep-teal);
      border-radius: 4px;
      padding: 15px;
      margin: 10px 0;
      background: white;
    }

    hr {
      border: none;
      border-top: 1px solid var(--deep-teal);
      margin: 20px 0;
    }
  </style>
</head>
<body>

<div id="auth-section">
  <h2>Welcome to Solvearn</h2>
  <h3>Sign Up</h3>
  <input type="email" id="signup-email" placeholder="Email"><br>
  <input type="password" id="signup-password" placeholder="Password"><br>
  <button onclick="signup()">Sign Up</button>

  <h3>Login</h3>
  <input type="email" id="login-email" placeholder="Email"><br>
  <input type="password" id="login-password" placeholder="Password"><br>
  <button onclick="login()">Log In</button>

  <hr>
  <button onclick="googleLogin()">Sign In with Google</button>
</div>

<div id="main-app" style="display:none;">
  <h2>Welcome to Solvearn</h2>
  <button onclick="showView('create')">Create Project</button>
  <button onclick="showView('notifications')">Notifications</button>

  <div id="home" class="view active">
    <h1>All Projects</h1>
    <div id="project-list"></div>
  </div>

  <div id="create" class="view">
    <h1>Create a Project</h1>
    <form id="create-form">
      <input type="text" id="project-name" placeholder="Project Name" required><br>
      <textarea id="project-desc" placeholder="Description" required></textarea><br>
      <input type="text" id="project-roles" placeholder="Roles (comma separated)" required><br>
      <button type="submit">Create</button>
    </form>
  </div>

  <div id="notifications" class="view">
    <h1>Your Notifications</h1>
    <div id="notif-list"></div>
  </div>
</div>

<script src="js/main.js"></script>
<script src="js/project.js"></script>
<script src="js/apply.js"></script>
<script src="js/chat.js"></script>
<script src="js/auth.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged,
    GoogleAuthProvider,
    signInWithPopup
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

  import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC_wK8NlJw-yUvsqKkBFxBP1GdzqEbzWP8",
    authDomain: "solvearn-mvp-a00f1.firebaseapp.com",
    projectId: "solvearn-mvp-a00f1",
    storageBucket: "solvearn-mvp-a00f1.firebasestorage.app",
    messagingSenderId: "71657733409",
    appId: "1:71657733409:web:1db68c51393ecd7dfc5260",
    measurementId: "G-NJGT0SJ2TP"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Signup with email/password
  window.signup = async function () {
    const email = document.getElementById("signup-email").value;
    const password = document.getElementById("signup-password").value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      alert("Signup successful!");
    } catch (error) {
      alert("Signup error: " + error.message);
    }
  };

  // Login with email/password
  window.login = async function () {
    const email = document.getElementById("login-email").value;
    const password = document.getElementById("login-password").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert("Login successful!");
    } catch (error) {
      alert("Login error: " + error.message);
    }
  };

  // Login with Google
  window.googleLogin = async function () {
    const provider = new GoogleAuthProvider();
    try {
      await signInWithPopup(auth, provider);
      alert("Google login successful!");
    } catch (error) {
      alert("Google login error: " + error.message);
    }
  };

  // Logout
  window.logout = function () {
    signOut(auth);
  };

  // Show/hide views
  onAuthStateChanged(auth, (user) => {
    if (user) {
      console.log("Logged in:", user.email);
      document.getElementById("auth-section").style.display = "none";
      document.getElementById("main-app").style.display = "block";
    } else {
      document.getElementById("auth-section").style.display = "block";
      document.getElementById("main-app").style.display = "none";
    }
  });

  const notifListDiv = document.getElementById("notif-list");

onSnapshot(query(collection(db, "notifications")), (snapshot) => {
  notifListDiv.innerHTML = "";
  snapshot.forEach(docSnap => {
    const notif = docSnap.data();
    if (notif.to === auth.currentUser.uid) {
      const notifDiv = document.createElement("div");
      notifDiv.innerHTML = `
        <p>${notif.message}</p>
        <small>${new Date(notif.timestamp).toLocaleString()}</small>
        <hr>
      `;
      notifListDiv.appendChild(notifDiv);
    }
  });
});


    import {
  collection,
  addDoc,
  getDocs,
  onSnapshot,
  query,
  doc,
  updateDoc,
  arrayRemove,
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

window.createProject = async function () {
  const title = document.getElementById("project-title").value;
  const desc = document.getElementById("project-desc").value;
  const roles = document.getElementById("project-roles").value.split(",").map(r => r.trim());

  try {
    await addDoc(collection(db, "projects"), {
      title,
      desc,
      roles,
      createdBy: auth.currentUser.uid,
      createdByEmail: auth.currentUser.email,
      applicants: []
    });
    alert("Project created!");
  } catch (err) {
    alert("Error creating project: " + err.message);
  }
};

// Show all projects live
const projectListDiv = document.getElementById("project-list");
onSnapshot(collection(db, "projects"), (snapshot) => {
  projectListDiv.innerHTML = "";
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const projectDiv = document.createElement("div");
    projectDiv.innerHTML = `
      <h3>${data.title}</h3>
      <p>${data.desc}</p>
      <p><strong>Roles:</strong> ${data.roles.join(", ")}</p>
      <p><strong>By:</strong> ${data.createdByEmail}</p>
      <button onclick="applyProject('${docSnap.id}')">Apply</button>
      ${data.createdBy === auth.currentUser?.uid
        ? `<button onclick="removeRole('${docSnap.id}')">Edit Roles</button>`
        : ''}
      <hr>
    `;
    projectListDiv.appendChild(projectDiv);
  });
});

// Apply to project
window.applyProject = async function (id) {
  const user = auth.currentUser;
  const projRef = doc(db, "projects", id);
  const snapshot = await getDocs(query(collection(db, "projects")));
  
  snapshot.forEach(async (docSnap) => {
    if (docSnap.id === id) {
      const data = docSnap.data();
      if (data.applicants.includes(user.uid)) {
        alert("Already applied!");
      } else {
        await updateDoc(projRef, {
          applicants: [...data.applicants, user.uid]
        });

        // âœ… Add notification to project creator
        await addDoc(collection(db, "notifications"), {
          to: data.createdBy,
          message: `${user.email} applied to your project "${data.title}"`,
          timestamp: Date.now(),
          read: false
        });

        alert("Applied!");
      }
    }
  });
};


// Edit roles (basic)
window.removeRole = async function (id) {
  const newRoles = prompt("Enter new roles (comma-separated)");
  if (!newRoles) return;
  await updateDoc(doc(db, "projects", id), {
    roles: newRoles.split(",").map(r => r.trim())
  });
  alert("Roles updated!");
};

  // Show/hide views
  window.showView = function(viewId) {
    document.querySelectorAll('.view').forEach(view => {
      view.classList.remove('active');
    });
    document.getElementById(viewId).classList.add('active');
  };
</script>

</body>
</html>
